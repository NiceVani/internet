<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "TH SarabunPSK", sans-serif;
        font-size: 16px;
        background-color: #f9f9f9;
      }
      .form-title {
        text-align: center;
        font-weight: bold;
        font-size: 20px;
        margin-bottom: 15px;
      }
      .btn-simple {
        font-size: 14px;
        background-color: #f2f2f2;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 8px 15px;
        margin-right: 10px;
        margin-bottom: 15px;
        cursor: pointer;
      }
      .btn-simple:hover {
        background-color: #e2e2e2;
      }
      .input-group {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 15px;
      }
      .input-group input {
        flex: 1;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 8px;
      }
      .btn-upload {
        font-size: 14px;
        background-color: #f2f2f2;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 8px 15px;
        cursor: pointer;
      }
      .btn-upload:hover {
        background-color: #e2e2e2;
      }
      .btn-confirm {
        background-color: #ff5722;
        color: white;
        font-size: 16px;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        margin-top: 20px;
        cursor: pointer;
      }
      .btn-confirm:hover {
        background-color: #e64a19;
      }
      .menu-icon {
        cursor: pointer;
        color: #6a1b9a;
        font-size: 24px;
        position: absolute;
        top: 15px;
        left: 15px;
      }
      .sidebar {
        position: fixed;
        top: 0;
        left: -250px;
        width: 250px;
        height: 100%;
        background-color: #ff5722;
        color: white;
        padding: 15px;
        transition: left 0.3s ease;
        z-index: 1000;
      }
      .sidebar.active {
        left: 0;
      }
      .sidebar h4 {
        color: white;
        font-size: 18px;
        margin-bottom: 15px;
      }
      .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
      }
      .overlay.active {
        display: block;
      }
      .table th,
      .table td {
        text-align: center;
        vertical-align: middle;
      }
      .table td {
        font-size: 14px;
      }
      .form-container {
        margin-top: 20px;
      }
      .textarea-container {
        margin-top: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .textarea-container textarea {
        width: 80%;
        margin-right: 10px;
      }
      .note {
        font-size: 14px;
        color: gray;
        text-align: center;
        margin-top: 30px;
      }
    </style>
  </head>
  <body>
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏°‡∏Ç‡∏µ‡∏î -->
    <div class="menu-icon" onclick="toggleSidebar()">&#9776;</div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="radio-container">
        <h4>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h4>
        <label>
          <input type="radio" name="booking-type" value="‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤" checked />
          ‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ </label
        ><br />
        <label>
          <input type="radio" name="booking-type" value="‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤" />
          ‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
        </label>
      </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- Content -->
    <div class="container mt-4">
      <h4 class="form-title">‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</h4>
      <form method="GET" action="submit_booking.php">
        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß -->
        <div class="form-container">
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
              <input
                type="text"
                class="form-control"
                id="student-name"
                value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î..."
                readonly
              />
            </div>
            <div class="col-md-6">
              <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</label>
              <input
                type="text"
                class="form-control"
                id="student-id"
                value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î..."
                readonly
              />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="stud-year">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</label>
              <input
                type="text"
                class="form-control"
                id="stud-year"
                value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î..."
                readonly
              />
            </div>
            <div class="col-md-4">
              <label for="phone-number">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
              <input
                type="text"
                class="form-control"
                id="phone-number"
                value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î..."
                readonly
              />
            </div>
          </div>
        </div>

        <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á -->
        <h5 class="mt-4">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h5>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡πâ‡∏≠‡∏á</th>
              <th>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á</th>
              <th>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="room-type-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td>
              <td id="room-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td>
              <td id="time-range-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td>
            </tr>
          </tbody>
        </table>

        <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
        <h5 class="mt-4">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h5>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</th>
              <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
              <th>
                <button type="button" class="btn-simple" onclick="addRow()">
                  +
                </button>
              </th>
            </tr>
          </thead>
          <tbody id="members-table-body">
            <tr>
              <td style="position: relative">
                <input
                  type="text"
                  class="form-control student-id-input"
                  placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï"
                  pattern="\d*"
                  title="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç"
                />
                <div class="dropdown-list"></div>
              </td>
              <td>
                <input
                  type="text"
                  class="form-control student-name-input"
                  placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"
                  readonly
                />
              </td>
              <td>
                <button
                  type="button"
                  class="btn btn-danger"
                  onclick="deleteRow(this)"
                >
                  ‡∏•‡∏ö
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° (‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°) -->
        <h5 class="mt-4">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° (‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°)</h5>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
              <th>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á</th>
              <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
            </tr>
          </thead>
          <tbody id="equipment-table-body">
            <tr>
              <td colspan="3">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td>
            </tr>
          </tbody>
        </table>

        <!-- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á -->
        <div class="textarea-container">
          <label class="form-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á</label>
          <div class="textarea-row">
            <select class="form-select" name="usage">
              <option value="‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠">
                ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠
              </option>
              <option value="‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°">
                ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
              </option>
              <option value="‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ">
                ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ
              </option>
            </select>
          </div>
          <button
              class="btn-confirm"
              type="button"
              style="margin-left: auto; display: block"
              onclick="submitBookingOut()"
          >
              ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
          </button>
        </div>

        <!-- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ -->
        <p class="note">
          ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏Ç‡∏≠‡∏á‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ø
          ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏ô‡πÄ‡∏£‡∏®‡∏ß‡∏£ ‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå ‡∏ñ‡∏∂‡∏á ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå ‡πÄ‡∏ß‡∏•‡∏≤ 8.00-21.00
          ‡∏ô.
        </p>
      </form>
    </div>

    <script>
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô toggle sidebar
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("overlay");
        sidebar.classList.toggle("active");
        overlay.classList.toggle("active");
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô "08:00:00" -> "8.00"
      function formatTimeForDisplay(timeStr) {
        const parts = timeStr.split(":");
        let hour = parts[0];
        const minute = parts[1];
        if (hour.startsWith("0")) {
          hour = hour.substring(1);
        }
        return hour + "." + minute;
      }

      // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å API /getRoomInfo
      async function loadRoomDetails(roomId) {
        try {
          const response = await fetch(
            `http://localhost:3000/getRoomInfo?room=${roomId}`
          );
          if (!response.ok) throw new Error("HTTP error " + response.status);
          const roomData = await response.json();
          if (roomData.length > 0) {
            const roomDetail = roomData[0];
            document.getElementById("room-info").textContent =
              roomDetail.Rooms_name || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            document.getElementById("room-type-info").textContent =
              roomDetail.Room_types || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
          } else {
            document.getElementById("room-info").textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            document.getElementById("room-type-info").textContent =
              "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
          }
        } catch (err) {
          console.error("Error fetching room details:", err);
          document.getElementById("room-info").textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
          document.getElementById("room-type-info").textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        }
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô
      async function fetchUserInfo() {
        try {
          const response = await fetch("http://localhost:3000/session", {
            method: "GET",
            credentials: "include",
          });
          if (!response.ok) {
            console.warn("‚ö†Ô∏è ‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô");
            document.getElementById("student-name").value = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
            return;
          }
          const userSession = await response.json();
          if (!userSession.data) {
            console.warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô");
            document.getElementById("student-name").value = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
            return;
          }
          document.getElementById("student-name").value =
            userSession.data.Name || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
          document.getElementById("student-id").value =
            userSession.data.Student_ID || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
          document.getElementById("stud-year").value =
            userSession.data.Study_year || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
          document.getElementById("phone-number").value =
            userSession.data.Phone_number || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        } catch (error) {
          console.error("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô:", error);
          document.getElementById("student-name").value = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î";
        }
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
      function addRow() {
        const tableBody = document.getElementById("members-table-body");
        const newRow = document.createElement("tr");
        newRow.innerHTML = `
        <td style="position: relative;">
          <input type="text" class="form-control student-id-input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï" pattern="\\d*" title="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç">
          <div class="dropdown-list"></div>
        </td>
        <td><input type="text" class="form-control student-name-input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" readonly></td>
        <td><button type="button" class="btn btn-danger" onclick="deleteRow(this)">‡∏•‡∏ö</button></td>
      `;
        tableBody.appendChild(newRow);
        initializeStudentIDInput(newRow.querySelector(".student-id-input"));
      }

      function deleteRow(button) {
        const row = button.closest("tr");
        row.remove();
      }

      // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô dropdown
      let studentData = [];
      async function fetchStudentData() {
        try {
          const response = await fetch(
            "http://localhost:3000/data/Student_information"
          );
          studentData = await response.json();
          console.log("‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", studentData);
        } catch (error) {
          console.error("‚ùå ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", error);
        }
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô filter ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡πÉ‡∏ô dropdown
      function filterStudentList(inputElement) {
        let value = inputElement.value.trim();
        let dropdown = inputElement.nextElementSibling;
        let row = inputElement.closest("tr");
        let nameInput = row.querySelector(".student-name-input");
        dropdown.innerHTML = "";
        dropdown.style.display = "none";
        if (value === "") return;
        let filtered = studentData.filter((student) =>
          student.Student_ID.startsWith(value)
        );
        if (filtered.length === 0) return;
        dropdown.style.display = "block";
        filtered.forEach((student) => {
          let option = document.createElement("div");
          option.classList.add("dropdown-item");
          option.innerHTML = `<span class="student-id" style="font-size: 22px; color: #333;">${student.Student_ID}</span>
                            <span class="student-name" style="font-size: 20px; margin-left: 12px; color: #555;">${student.Name}</span>`;
          option.addEventListener("mouseover", function () {
            this.style.fontWeight = "bold";
            this.style.fontSize = "24px";
          });
          option.addEventListener("mouseout", function () {
            this.style.fontWeight = "normal";
            this.style.fontSize = "22px";
          });
          option.addEventListener("mouseover", function () {
            inputElement.value = student.Student_ID;
            nameInput.value = student.Name;
          });
          option.addEventListener("click", function () {
            inputElement.value = student.Student_ID;
            nameInput.value = student.Name;
            dropdown.style.display = "none";
          });
          dropdown.appendChild(option);
        });
      }

      function initializeStudentIDInput(inputElement) {
        let dropdown = inputElement.nextElementSibling;
        inputElement.addEventListener("input", function () {
          filterStudentList(inputElement);
        });
        inputElement.addEventListener("blur", function () {
          setTimeout(() => (dropdown.style.display = "none"), 200);
        });
      }

      // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
      async function fetchEquipmentInfo() {
        console.log("üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå...");
        const params = new URLSearchParams(window.location.search);
        let equipmentData = params.get("equipments");
        if (!equipmentData) {
          console.warn("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡πà‡∏≤ `equipments` ‡πÉ‡∏ô URL");
          return;
        }
        const decodedEquipmentData = decodeURIComponent(equipmentData).replace(
          /%2C/g,
          ","
        );
        const equipmentDetails = decodedEquipmentData
          .split(",")
          .map((item) => {
            const parts = item.split(":");
            if (parts.length !== 2) return null;
            return {
              id: parts[0].trim(),
              amount: parts[1].trim(),
            };
          })
          .filter((item) => item !== null);
        if (equipmentDetails.length === 0) {
          console.warn("‚ùå ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `equipments` ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
          return;
        }
        const equipmentIds = [
          ...new Set(equipmentDetails.map((item) => item.id)),
        ];
        try {
          const response = await fetch(
            `http://localhost:3000/getEquipmentsByIds?ids=${equipmentIds.join(
              ","
            )}`
          );
          const equipmentList = await response.json();
          if (!Array.isArray(equipmentList) || equipmentList.length === 0) {
            console.warn("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
            return;
          }
          const tableBody = document.getElementById("equipment-table-body");
          tableBody.innerHTML = "";
          equipmentDetails.forEach((equip) => {
            const equipmentInfo = equipmentList.find(
              (e) => String(e.Equipments_ID) === equip.id
            );
            if (!equipmentInfo) return;
            const row = document.createElement("tr");
            row.innerHTML = `
            <td>${equipmentInfo.Equipments_name}</td>
            <td>SC2-${params.get("room")}</td>
            <td>${equip.amount}</td>
          `;
            tableBody.appendChild(row);
          });
        } catch (error) {
          console.error("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:", error);
        }
      }

      // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
      document.addEventListener("DOMContentLoaded", async function () {
        await fetchStudentData();
        document
          .querySelectorAll(".student-id-input")
          .forEach(initializeStudentIDInput);
        await fetchUserInfo();
        await fetchEquipmentInfo();

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏à‡∏≤‡∏Å URL
        const params = new URLSearchParams(window.location.search);
        const roomParam = params.get("room");
        const startTimeParam = params.get("startTime"); // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á "10:00:00"
        const endTimeParam = params.get("endTime"); // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á "12:00:00"

        if (roomParam) {
          loadRoomDetails(roomParam);
        }
        if (startTimeParam && endTimeParam) {
          const formattedStartTime = formatTimeForDisplay(startTimeParam);
          const formattedEndTime = formatTimeForDisplay(endTimeParam);
          document.getElementById(
            "time-range-info"
          ).textContent = `${formattedStartTime}-${formattedEndTime} ‡∏ô.`;
        } else {
          document.getElementById("time-range-info").textContent =
            "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏•‡∏≤";
        }
      });

      // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ï‡∏≤‡∏° Radio Button ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
      document
        .querySelectorAll('input[name="booking-type"]')
        .forEach(function (radio) {
          radio.addEventListener("change", function () {
            if (this.value === "‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤") {
              window.location.href = "./TimeOut.html";
            } else if (this.value === "‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤") {
              window.location.href = "./TimeIn.html";
            }
          });
        });

        async function submitBookingOut() {
          const studentId = document.getElementById("student-id").value;
          const roomId = new URLSearchParams(window.location.search).get("room");
          const usedDate = new URLSearchParams(window.location.search).get("date");
          const startTime = new URLSearchParams(window.location.search).get("startTime");
          const endTime = new URLSearchParams(window.location.search).get("endTime");
          const reason = document.querySelector("select[name='usage']").value;
          const requestType = "‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤"; // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤" ‡πÄ‡∏™‡∏°‡∏≠
      
          // ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
          const memberInputs = document.querySelectorAll(".student-id-input");
          const members = Array.from(memberInputs)
              .map(input => input.value.trim())
              .filter(id => id !== "");
      
          if (!studentId || !roomId || !usedDate || !startTime || !endTime || !reason) {
              alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
              return;
          }
      
          const bookingData = {
              room_id: roomId,
              used_date: usedDate,
              student_id: studentId,
              start_time: startTime,
              end_time: endTime,
              reason: reason,
              request_type: requestType,
              members: members // ‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏õ‡∏ó‡∏µ‡πà backend
          };
      
          try {
              const response = await fetch("http://localhost:3000/bookRoomOut", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(bookingData),
                  credentials: "include"
              });
      
              const result = await response.json();
              if (response.ok) {
                  alert("‚úÖ ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                  window.location.href = "home.html"; // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
              } else {
                  alert("‚ùå " + result.error);
              }
          } catch (err) {
              console.error("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:", err);
              alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á");
          }
      }
      

    </script>
  </body>
</html>
