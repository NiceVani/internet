<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ (TimeIn)</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      font-family: "TH SarabunPSK", sans-serif;
      font-size: 16px;
      background-color: #f9f9f9;
      padding: 20px;
    }

    .form-title {
      text-align: center;
      font-weight: bold;
      font-size: 20px;
      margin-bottom: 15px;
    }

    .form-label {
      display: block;
      /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ label ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà */
      font-weight: bold;
    }

    textarea#additional-details {
      margin-top: 5px;
    }

    input[readonly],
    select {
      background-color: #e9ecef;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 14px;
      padding: 5px;
      height: auto;
    }

    .table {
      margin-top: 5px;
    }

    .table th {
      background-color: #f2f2f2;
      text-align: center;
      vertical-align: middle;
      font-size: 14px;
      border: 1px solid #dee2e6;
      padding: 5px;
    }

    .table td {
      padding: 5px;
      text-align: center;
      vertical-align: middle;
      border: 1px solid #dee2e6;
      height: 30px;
      font-size: 14px;
    }

    .table td span {
      display: inline-block;
      width: 100%;
      background-color: transparent;
      text-align: center;
    }

    .row-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
    }

    h5 {
      font-weight: bold;
      font-size: 16px;
      margin: 0;
    }

    .btn-add {
      font-size: 20px;
      color: #6a1b9a;
      background: none;
      border: none;
      cursor: pointer;
    }

    .btn-add:hover {
      color: #ff5722;
    }

    .menu-icon {
      cursor: pointer;
      color: #6a1b9a;
      font-size: 20px;
      position: absolute;
      top: 15px;
      left: 15px;
    }

    .btn-confirm {
      background-color: #ff5722;
      color: white;
      font-size: 16px;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-confirm:hover {
      background-color: #e64a19;
    }

    .textarea-container {
      margin-top: 15px;
    }

    .textarea-container label {
      font-size: 16px;
    }

    .textarea-row {
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    .textarea-row textarea {
      flex: 1;
      max-width: calc(100% - 120px);
      height: 50px;
    }

    .textarea-row .btn-confirm {
      flex-shrink: 0;
      margin-top: 0;
      margin-left: auto;
    }

    .note {
      font-size: 14px;
      color: gray;
      margin-top: 10px;
      text-align: center;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: -250px;
      width: 250px;
      height: 100%;
      background-color: #ff5722;
      color: white;
      padding: 15px;
      transition: left 0.3s ease;
      z-index: 1000;
    }

    .sidebar.active {
      left: 0;
    }

    .sidebar h4 {
      color: white;
      font-size: 18px;
      margin-bottom: 15px;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }

    .overlay.active {
      display: block;
    }

    /* Element ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ô */
    #day-name {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 10px;
      text-align: center;
    }
  </style>
</head>

<body>
  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏°‡∏Ç‡∏µ‡∏î -->
  <div class="menu-icon" onclick="toggleSidebar()">&#9776;</div>
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="radio-container">
      <h4>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h4>
      <label>
        <input type="radio" name="booking-type" value="‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤" />
        ‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤
      </label>
      <br />
      <label>
        <input type="radio" name="booking-type" value="‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤" checked />
        ‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
      </label>
    </div>
  </div>
  <!-- Overlay -->
  <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

  <div class="container mt-4">
    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏à‡∏≤‡∏Å URL -->
    <!-- <div id="day-name">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div> -->
    <h4 class="form-title">‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</h4>
    <form method="GET" action="submit_booking.php">
      <!-- User Information -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
          <input type="text" class="form-control" id="student-name" value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î..." readonly />
        </div>
        <div class="col-md-6">
          <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</label>
          <input type="text" class="form-control" id="student-id" value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î..." readonly />
        </div>
      </div>
      <div class="row mb-3">
        <div class="col-md-4">
          <label for="stud-year" class="form-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</label>
          <input type="text" class="form-control" id="stud-year" value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î..." readonly />
        </div>
        <div class="col-md-4">
          <label for="phone-number" class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
          <input type="text" class="form-control" id="phone-number" value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î..." readonly />
        </div>
      </div>
      <!-- Booking Details -->
      <div class="row-header">
        <h5>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h5>
      </div>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡πâ‡∏≠‡∏á</th>
            <th>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á</th>
            <th>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td id="room-type-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td>
            <td id="room-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td>
            <td id="time-range-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td>
          </tr>
        </tbody>
      </table>
      <!-- Desk Selection Details -->
      <!-- <div class="row-header">
        <h5>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° (‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</h5>
      </div> -->
      <!-- <div class="mb-3">
        <p id="desks-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
      </div> -->
      <!-- Equipment Details -->
      <h5>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° (‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°)</h5>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
          </tr>
        </thead>
        <tbody id="equipment-table-body">
          <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        </tbody>
      </table>
      </table>
      <h5>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° (‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</h5>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>‡πÅ‡∏ñ‡∏ß</th>
            <th>‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á</th>
          </tr>
        </thead>
        <tbody id="computer-table-body">
          <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        </tbody>
      </table>
      <!-- Usage Information -->
      <div class="textarea-container">
        <label class="form-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á</label>
        <div class="textarea-row">
          <select class="form-select" name="usage">
            <option value="‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠">
              ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠
            </option>
            <option value="‡∏Ç‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏á‡∏≤‡∏ô">
              ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
            </option>
            <option value="‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ß‡∏¥‡∏à‡∏±‡∏¢">
              ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ß‡∏¥‡∏à‡∏±‡∏¢
            </option>
            <option value="‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ">
              ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ
            </option>
            <option value="‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ä‡∏°‡∏£‡∏°">
              ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ä‡∏°‡∏£‡∏°
            </option>
            <option value="‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå">
              ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
            </option>
            <option value="‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≥‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠">
              ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≥‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
            </option>
            <option value="‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏≠‡∏∑‡πà‡∏ô ‡πÜ">
              ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏≠‡∏∑‡πà‡∏ô ‡πÜ
            </option>
          </select>
        </div>
        <br />
        <div class="mb-3">
          <label for="additional-details" class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
          <textarea id="additional-details" class="form-control" rows="3"
            placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
        </div>
        <!-- <button
          class="btn-confirm"
          type="button"
          style="margin-left: auto; display: block"
          onclick="submitBooking(); window.location.href='home.html'"
        >
          ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
        </button> -->
        <button class="btn-confirm" type="button" style="margin-left: auto; display: block" onclick="submitBookingA()">
          ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
        </button>
      </div>
      <p class="note">
        ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏Ç‡∏≠‡∏á‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ø
        ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏ô‡πÄ‡∏£‡∏®‡∏ß‡∏£ ‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡∏ñ‡∏∂‡∏á ‡∏®‡∏∏‡∏Å‡∏£‡πå ‡πÄ‡∏ß‡∏•‡∏≤ 8.00 - 17.00
        ‡∏ô. ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏±‡∏Å‡∏Ç‡∏±‡∏ï‡∏§‡∏Å‡∏©‡πå
      </p>
    </form>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script><!--sweet alert-->
  <div id="date-info" style="display: none"></div>
  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Socket.io Client -->
  <script src="https://cdn.socket.io/4.5.1/socket.io.min.js"></script>
  <script>
    // WebSocket connection
    const socket = io("http://localhost:3000");
    socket.on("connect", () => {
      console.log("WebSocket connected on TimeIn.html");
    });
    socket.on("booking_update", (data) => {
      console.log("Received booking update via WebSocket:", data);
    });
  </script>
  <script>
    // Utility function: Format time from "08:00:00" to "8.00"
    function formatTimeForDisplay(timeStr) {
      const parts = timeStr.split(":");
      let hour = parts[0];
      const minute = parts[1];
      if (hour.startsWith("0")) {
        hour = hour.substring(1);
      }
      return hour + "." + minute;
    }
    // Load equipment mapping from API /getEquipmentInformation
    async function loadEquipmentMapping() {
      let equipmentMapping = {};
      try {
        const response = await fetch("http://localhost:3000/getEquipmentInformation");
        if (!response.ok) throw new Error("HTTP error " + response.status);

        const equipData = await response.json();
        console.log("‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å API:", equipData);

        // ‡πÅ‡∏°‡∏õ‡∏Ñ‡πà‡∏≤ equipment_id -> equipment_name
        equipData.forEach((item) => {
          equipmentMapping[item.equipment_id] = item.equipment_name;
        });

      } catch (err) {
        console.error("‚ùå Error fetching equipment information:", err);
      }
      return equipmentMapping;
    }

    // Load room details from API /roomdetail
    async function loadRoomDetails(roomId) {
      try {
        const response = await fetch("http://localhost:3000/roomdetail");
        if (!response.ok) throw new Error("HTTP error " + response.status);
        const rooms = await response.json();

        // ‡∏´‡∏≤ room ‡∏ó‡∏µ‡πà room_id ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö roomParam
        const roomDetail = rooms.find((room) => room.room_id == roomId);
        console.log("‚úÖ Room Detail:", roomDetail);

        if (roomDetail) {
          document.getElementById("room-info").textContent = roomDetail.room_name || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
          document.getElementById("room-type-info").textContent = roomDetail.room_type || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";

        } else {
          document.getElementById("room-info").textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
          document.getElementById("room-type-info").textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        }
      } catch (err) {
        console.error("Error fetching room details:", err);
        document.getElementById("room-info").textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        document.getElementById("room-type-info").textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
      }
    }


    function displaySelectedComputers() {
        const urlParams = new URLSearchParams(window.location.search);
        const desksParam = urlParams.get("desks");
        const roomId = urlParams.get("room");
        const computerTableBody = document.getElementById("computer-table-body");
    
        if (!desksParam) {
            computerTableBody.innerHTML = `<tr><td colspan="2">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</td></tr>`;
            return;
        }
    
        const deskItems = desksParam.split(",").map(d => parseInt(d.trim(), 10));
        
        // ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ñ‡∏ß‡∏•‡∏∞ 11 ‡∏ï‡∏±‡∏ß (‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á)
        let desksPerRow = 11;
        if (roomId === "308") desksPerRow = 6;
    
        let rowMap = {};
        deskItems.forEach(desk => {
            const row = Math.ceil(desk / desksPerRow);
            if (!rowMap[row]) rowMap[row] = [];
            rowMap[row].push(desk);
        });
    
        const sortedRows = Object.keys(rowMap).sort((a, b) => a - b);
        computerTableBody.innerHTML = sortedRows.map(row =>
            `<tr><td>‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà ${row}</td><td>${rowMap[row].sort((a, b) => a - b).join(", ")}</td></tr>`
        ).join("");
    }
  

    // Main initialization
    document.addEventListener("DOMContentLoaded", async () => {
      // ‡∏î‡∏∂‡∏á query parameters ‡∏à‡∏≤‡∏Å URL
      const urlParams = new URLSearchParams(window.location.search);
      const dateParam = urlParams.get("date"); // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: yyyy-mm-dd
      const roomParam = urlParams.get("room"); // ‡πÄ‡∏ä‡πà‡∏ô "307"
      const startTimeParam = urlParams.get("startTime"); // ‡πÄ‡∏ä‡πà‡∏ô "08:00:00"
      const endTimeParam = urlParams.get("endTime"); // ‡πÄ‡∏ä‡πà‡∏ô "17:00:00"
      const desksParam = urlParams.get("desks"); // ‡πÄ‡∏ä‡πà‡∏ô "27,26,16"
      const equipmentsParam = urlParams.get("equipments"); // ‡πÄ‡∏ä‡πà‡∏ô "12:1,13:1,14:1,15:1"
      console.log("üìå Room Param from URL:", roomParam);
      // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
      document.getElementById("date-info").textContent = dateParam;
      await loadRoomDetails(roomParam);
      displaySelectedComputers(desksParam);
      const formattedStartTime = formatTimeForDisplay(startTimeParam);
      const formattedEndTime = formatTimeForDisplay(endTimeParam);
      document.getElementById(
        "time-range-info"
      ).textContent = `${formattedStartTime}-${formattedEndTime} ‡∏ô.`;
      //document.getElementById("desks-info").textContent = desksParam;

      // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô URL
      if (dateParam) {
        const dateObj = new Date(dateParam);
        const daysArr = [
          "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå",
          "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå",
          "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£",
          "‡∏û‡∏∏‡∏ò",
          "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ",
          "‡∏®‡∏∏‡∏Å‡∏£‡πå",
          "‡πÄ‡∏™‡∏≤‡∏£‡πå",
        ];
        const dayName = daysArr[dateObj.getDay()];
        // document.getElementById("day-name").textContent = dayName;
      }

      // ‡∏î‡∏∂‡∏á equipment mapping ‡∏à‡∏≤‡∏Å API
      const equipmentMapping = await loadEquipmentMapping();
      let equipmentTableRows = "";
      if (equipmentsParam) {
        const equipmentItems = equipmentsParam.split(",");
        equipmentItems.forEach((item) => {
          const [id, amount] = item.split(":");
          const name = equipmentMapping[id] || id;
          equipmentTableRows += `<tr>
            <td>${name}</td>
            <td>${amount}</td>
          </tr>`;
        });
      }
      document.getElementById("equipment-table-body").innerHTML =
        equipmentTableRows;

      // Debug logging
      console.log("Received parameters:");
      console.log("Date:", dateParam);
      console.log("Start Time:", startTimeParam);
      console.log("End Time:", endTimeParam);
      console.log("Desks:", desksParam);
      console.log("Equipments (raw):", equipmentsParam);
      console.log("Equipment mapping:", equipmentMapping);
      console.log("Equipments (mapped HTML):", equipmentTableRows);
    });

    async function loadEquipmentDetails() {
      console.log("üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå...");

      // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å URL
      const urlParams = new URLSearchParams(window.location.search);
      const equipmentsParam = urlParams.get("equipments"); // ‡πÄ‡∏ä‡πà‡∏ô "12:1,13:2"

      console.log("üìå Equipments Param:", equipmentsParam);

      if (!equipmentsParam) {
        console.warn("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å URL");
        return;
      }

      // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å API
      const equipmentMapping = await loadEquipmentMapping();

      let equipmentTableRows = "";
      const equipmentItems = equipmentsParam.split(",");

      equipmentItems.forEach((item) => {
        const [id, amount] = item.split(":");
        const name = equipmentMapping[id] || `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (${id})`;
        equipmentTableRows += `<tr>
              <td>${name}</td>
              <td>${amount}</td>
          </tr>`;
      });

      console.log("‚úÖ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", equipmentTableRows);

      document.getElementById("equipment-table-body").innerHTML = equipmentTableRows;
    }
    document.addEventListener("DOMContentLoaded", async function () {
      await loadEquipmentDetails();
    });



    // Fetch user info from API /user and display in input fields
    async function fetchUserInfo() {
      try {
        const response = await fetch("http://localhost:3000/session", {
          credentials: "include",
        });

        const userSession = await response.json();
        if (!userSession.data) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà");
          window.location.href = "login.html";
          return;
        }

        console.log("‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å session:", userSession.data);


        // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡∏•‡∏á input ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ key ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        document.getElementById("student-name").value =
          userSession.data.full_name || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        document.getElementById("student-id").value =
          userSession.data.student_id || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        document.getElementById("stud-year").value =
          userSession.data.study_year || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        document.getElementById("phone-number").value =
          userSession.data.phone_number || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"; // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ backend ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏°‡∏≤
      } catch (error) {
        console.error("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:", error);
      }
    }


    window.onload = fetchUserInfo;

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö toggle sidebar
    function toggleSidebar() {
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("overlay");
      sidebar.classList.toggle("active");
      overlay.classList.toggle("active");
    }

    async function submitBookingA() {
      const urlParams = new URLSearchParams(window.location.search);
      const room_id = urlParams.get("room");
      const used_date = urlParams.get("date");
      const start_time = urlParams.get("startTime");
      const end_time = urlParams.get("endTime");

      const request_type = window.location.pathname.includes("TimeOut") ? "‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤" : "‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤";
      const request_reason = document.querySelector("select[name='usage']").value;
      const detail_request_reason = document.getElementById("additional-details").value || null;

      const desks = urlParams.get("desks") ? urlParams.get("desks").split(",").map(Number) : [];
      const equipments = urlParams.get("equipments") || "";

      const student_name = document.getElementById("student-name")?.value || null;
      const phone_number = document.getElementById("phone-number")?.value || null;

      if (!room_id || !used_date || !start_time || !end_time || !request_reason) {
        Swal.fire("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö", "warning");
        return;
      }

      const roomText = document.getElementById("room-info")?.textContent || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
      const roomType = document.getElementById("room-type-info")?.textContent || "-";
      const timeRange = `${formatTimeForDisplay(start_time)} - ${formatTimeForDisplay(end_time)} ‡∏ô.`;

      const confirmResult = await Swal.fire({
        title: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á",
        html: `
      <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á:</strong> ${used_date}<br/>
      <strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á:</strong> ${timeRange}<br/>
      <strong>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á:</strong> ${roomText} (${roomType})<br/>
      <div style="color:red; margin-top:10px;">
        ‡∏´‡∏≤‡∏Å‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏î‡πâ
      </div>
    `,
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô",
        cancelButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
      });

      if (!confirmResult.isConfirmed) return;

      try {
        const response = await fetch("http://localhost:3000/submitBookingA", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({
            room_id, used_date, start_time, end_time,
            request_type, request_reason, detail_request_reason,
            desks, equipments, student_name, phone_number
          })
        });

        const result = await response.json();
        if (result.success) {
          Swal.fire("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", "success").then(() => {
            window.location.href = "home.html";
          });
        } else {
          Swal.fire("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", result.error || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ", "error");
        }
      } catch (error) {
        console.error("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
        Swal.fire("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö", "error");
      }
    }



    // ‡∏ú‡∏π‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
  </script>
</body>

</html>